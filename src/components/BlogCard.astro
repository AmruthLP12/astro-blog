---
import Card from "@/components/starwind/card/Card.astro";
import CardContent from "@/components/starwind/card/CardContent.astro";
import Button from "@/components/starwind/button/Button.astro";
import { Image } from "astro:assets";

interface Props {
  post: {
    slug: string;
    body: string;
    data: {
      title: string;
      description: string;
      author?: string;
      pubDate: Date;
      updatedDate?: Date;
      category?: string;
      tags?: string[];
      heroImageLight?: any;
      heroImageDark?: any;
    };
  };
  showImage?: boolean;
  showBadge?: boolean;
  badgeText?: string;
  variant?: "default" | "compact";
}

const {
  post,
  showImage = true,
  showBadge = false,
  badgeText,
  variant = "default",
} = Astro.props;

// Calculate reading time
const calculateReadingTime = (body: string) => {
  const wordsPerMinute = 200;
  const wordCount = body.split(/\s+/).length;
  return Math.ceil(wordCount / wordsPerMinute);
};

// Format dates
const formatDate = (date: Date) => {
  return date.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric",
  });
};

const formatDateWithYear = (date: Date) => {
  return date.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric",
    year: "numeric",
  });
};
---

<Card
  class="group hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 border-2 border-transparent hover:border-primary/20 overflow-hidden h-full"
>
  <CardContent class="p-0 h-full flex flex-col">
    {/* Hero Image */}
    {
      showImage && post.data.heroImageLight && (
        <div class="relative h-48 overflow-hidden">
          <Image
            src={post.data.heroImageLight}
            alt={post.data.title}
            width={400}
            height={250}
            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300 block dark:hidden"
          />
          {post.data.heroImageDark && (
            <Image
              src={post.data.heroImageDark}
              alt={post.data.title}
              width={400}
              height={250}
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300 hidden dark:block"
            />
          )}
          <div class="absolute inset-0 bg-linear-to-t from-black/60 to-transparent" />

          {/* Badge on image */}
          {showBadge && badgeText && (
            <div class="absolute top-3 left-3">
              <span class="inline-flex items-center justify-center px-3 py-1 text-xs font-bold rounded-full bg-primary text-primary-foreground shadow-lg">
                {badgeText}
              </span>
            </div>
          )}

          {/* Category Badge */}
          {post.data.category && (
            <div
              class:list={["absolute top-3", showBadge ? "right-3" : "left-3"]}
            >
              <a
                href={`/blog/category/${post.data.category.toLowerCase()}/`}
                class="inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-md bg-background/90 backdrop-blur-sm text-foreground border border-border/50 hover:bg-background transition-colors"
              >
                {post.data.category}
              </a>
            </div>
          )}
        </div>
      )
    }

    {/* Content */}
    <div class="p-6 space-y-4 flex-1 flex flex-col">
      {/* Category badge when no image */}
      {
        !showImage && post.data.category && (
          <div class="flex items-center gap-2">
            <span class="inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-md bg-primary/10 text-primary">
              {post.data.category}
            </span>
            {showBadge && badgeText && (
              <span class="inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-md bg-primary text-primary-foreground">
                {badgeText}
              </span>
            )}
          </div>
        )
      }

      <div class="space-y-3 flex-1">
        <h3
          class:list={[
            "font-bold leading-tight group-hover:text-primary transition-colors line-clamp-2",
            variant === "compact" ? "text-lg" : "text-xl",
          ]}
        >
          {post.data.title}
        </h3>

        <p class="text-sm text-muted-foreground leading-relaxed line-clamp-3">
          {post.data.description}
        </p>
      </div>

      {/* Tags */}
      {
        post.data.tags && post.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-1.5">
            {post.data.tags
              .slice(0, variant === "compact" ? 2 : 3)
              .map((tag) => (
                <a
                  href={`/blog/tag/${tag.toLowerCase()}/`}
                  class="inline-flex items-center px-2 py-0.5 text-xs rounded-md bg-muted/50 text-muted-foreground border border-border/50 hover:bg-muted transition-colors"
                >
                  #{tag}
                </a>
              ))}
            {post.data.tags.length > (variant === "compact" ? 2 : 3) && (
              <span class="inline-flex items-center px-2 py-0.5 text-xs rounded-md bg-muted/50 text-muted-foreground border border-border/50">
                +{post.data.tags.length - (variant === "compact" ? 2 : 3)}
              </span>
            )}
          </div>
        )
      }

      {/* Meta Info */}
      <div class="pt-4 border-t border-border space-y-3">
        <div class="flex flex-col gap-2 text-xs text-muted-foreground">
          <div class="flex items-center justify-between">
            <time class="flex items-center gap-1" title="Published">
              <svg
                class="w-3.5 h-3.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              {
                variant === "compact"
                  ? formatDate(post.data.pubDate)
                  : formatDateWithYear(post.data.pubDate)
              }
            </time>

            <span class="flex items-center gap-1">
              <svg
                class="w-3.5 h-3.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              {calculateReadingTime(post.body)} min
            </span>
            {
              post.data.author && (
                <span class="flex items-center gap-1">
                  <svg
                    class="w-3.5 h-3.5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                    ></path>
                  </svg>
                  {post.data.author}
                </span>
              )
            }
            
          </div>

          {/* Show updated date if different from published date */}
          {
            post.data.updatedDate &&
              post.data.updatedDate.getTime() !==
                post.data.pubDate.getTime() && (
                <time
                  class="flex items-center gap-1 text-primary"
                  title="Last updated"
                >
                  <svg
                    class="w-3.5 h-3.5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                    />
                  </svg>
                  Updated{" "}
                  {variant === "compact"
                    ? formatDate(post.data.updatedDate)
                    : formatDateWithYear(post.data.updatedDate)}
                </time>
              )
          }
        </div>

        {/* CTA Button */}
        <Button
          href={`/blog/${post.slug}/`}
          variant="ghost"
          size="sm"
          class="w-full group-hover:bg-primary group-hover:text-primary-foreground transition-all flex items-center justify-between"
        >
          Read Article
          <svg
            class="w-4 h-4 group-hover:translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </Button>
      </div>
    </div>
  </CardContent>
</Card>

---
import { getCollection } from "astro:content";
import Card from "./starwind/card/Card.astro";
import CardContent from "./starwind/card/CardContent.astro";
const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);
import Button from "./starwind/button/Button.astro";

const calculateReadingTime = (body: string) => {
  const wordsPerMinute = 200;
  const wordCount = body.split(/\s+/).length;
  return Math.ceil(wordCount / wordsPerMinute);
};
---

{
  posts.length > 0 && (
    <section class="mb-20">
      <div class="flex items-center gap-2 mb-8">
        <div class="h-px flex-1 bg-border" />
        <span class="text-sm font-semibold uppercase tracking-wide text-muted-foreground flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          Featured
        </span>
        <div class="h-px flex-1 bg-border" />
      </div>

      <Card class="border-2 border-primary/20 hover:border-primary/40 hover:shadow-2xl transition-all duration-300 overflow-hidden group">
        <CardContent class="p-0">
          <div class="flex flex-col lg:flex-row">
            {posts[0].data.heroImageLight && (
              <div class="relative lg:w-2/5 overflow-hidden">
                <img
                  src={posts[0].data.heroImageLight.src}
                  alt={posts[0].data.title}
                  width={600}
                  height={400}
                  loading="eager"
                  class="w-full h-64 lg:h-full object-cover group-hover:scale-105 transition-transform duration-300 block dark:hidden"
                />
                {posts[0].data.heroImageDark && (
                  <img
                    src={posts[0].data.heroImageDark.src}
                    alt={posts[0].data.title}
                    width={600}
                    height={400}
                    loading="eager"
                    class="w-full h-64 lg:h-full object-cover group-hover:scale-105 transition-transform duration-300 hidden dark:block"
                  />
                )}
                <div class="absolute inset-0 bg-linear-to-t from-black/50 to-transparent lg:bg-linear-to-r" />
              </div>
            )}

            <div class="flex-1 p-8 lg:p-10 space-y-6">
              <div class="flex items-center gap-3 flex-wrap">
                {posts[0].data.category && (
                  <a
                    href={`/blog/category/${posts[0].data.category.toLowerCase()}/`}
                    class="inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium rounded-full bg-primary/10 text-primary border border-primary/20"
                  >
                    <svg
                      class="w-3 h-3"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                      />
                    </svg>
                    {posts[0].data.category}
                  </a>
                )}
                <span class="inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium rounded-full bg-primary text-primary-foreground">
                  Latest Post
                </span>
              </div>

              <h2 class="text-3xl md:text-4xl font-bold leading-tight group-hover:text-primary transition-colors">
                {posts[0].data.title}
              </h2>

              <p class="text-muted-foreground leading-relaxed text-base md:text-lg">
                {posts[0].data.description}
              </p>

              <div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
                <time class="flex items-center gap-1.5">
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    />
                  </svg>
                  {posts[0].data.pubDate.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </time>
                <span class="flex items-center gap-1.5">
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  {calculateReadingTime(posts[0].body)} min read
                </span>
              </div>

              <Button
                href={`/blog/${posts[0].slug}/`}
                variant="primary"
                size="lg"
                class="mt-4"
              >
                Read Full Article
                <svg
                  class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 7l5 5m0 0l-5 5m5-5H6"
                  />
                </svg>
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>
    </section>
  )
}
